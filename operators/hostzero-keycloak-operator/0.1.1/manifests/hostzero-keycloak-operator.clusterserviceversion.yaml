apiVersion: operators.coreos.com/v1alpha1
kind: ClusterServiceVersion
metadata:
  annotations:
    alm-examples: |-
      [
        {
          "apiVersion": "keycloak.hostzero.com/v1beta1",
          "kind": "KeycloakInstance",
          "metadata": {
            "name": "keycloak-instance"
          },
          "spec": {
            "baseUrl": "http://keycloak:8080",
            "credentials": {
              "secretName": "keycloak-admin",
              "usernameKey": "username",
              "passwordKey": "password"
            }
          }
        },
        {
          "apiVersion": "keycloak.hostzero.com/v1beta1",
          "kind": "KeycloakRealm",
          "metadata": {
            "name": "my-realm"
          },
          "spec": {
            "instanceRef": "keycloak-instance",
            "definition": {
              "realm": "my-realm",
              "displayName": "My Realm",
              "enabled": true
            }
          }
        },
        {
          "apiVersion": "keycloak.hostzero.com/v1beta1",
          "kind": "KeycloakClient",
          "metadata": {
            "name": "my-client"
          },
          "spec": {
            "realmRef": "my-realm",
            "definition": {
              "clientId": "my-client",
              "name": "My Application",
              "publicClient": false,
              "standardFlowEnabled": true
            },
            "clientSecret": {
              "secretName": "my-client-secret"
            }
          }
        },
        {
          "apiVersion": "keycloak.hostzero.com/v1beta1",
          "kind": "KeycloakUser",
          "metadata": {
            "name": "my-user"
          },
          "spec": {
            "realmRef": "my-realm",
            "definition": {
              "username": "john.doe",
              "email": "john.doe@example.com",
              "enabled": true,
              "firstName": "John",
              "lastName": "Doe"
            }
          }
        }
      ]
    capabilities: Deep Insights
    categories: Security,Integration & Delivery
    certified: "false"
    containerImage: ghcr.io/hostzero-gmbh/keycloak-operator:v0.1.1
    createdAt: "2025-01-11T00:00:00Z"
    description: A Kubernetes operator for managing Keycloak resources declaratively
    operators.operatorframework.io/builder: operator-sdk-v1.37.0
    operators.operatorframework.io/project_layout: go.kubebuilder.io/v4
    repository: https://github.com/Hostzero-GmbH/keycloak-operator
    support: Hostzero GmbH
  name: hostzero-keycloak-operator.v0.1.1
  namespace: placeholder
spec:
  apiservicedefinitions: {}
  customresourcedefinitions:
    owned:
      - description: ClusterKeycloakInstance makes a Keycloak server known to the operator at cluster scope
        displayName: Cluster Keycloak Instance
        kind: ClusterKeycloakInstance
        name: clusterkeycloakinstances.keycloak.hostzero.com
        version: v1beta1
      - description: ClusterKeycloakRealm manages a Keycloak realm at cluster scope
        displayName: Cluster Keycloak Realm
        kind: ClusterKeycloakRealm
        name: clusterkeycloakrealms.keycloak.hostzero.com
        version: v1beta1
      - description: KeycloakClient manages OAuth2/OIDC clients in Keycloak
        displayName: Keycloak Client
        kind: KeycloakClient
        name: keycloakclients.keycloak.hostzero.com
        version: v1beta1
      - description: KeycloakClientScope manages client scopes in Keycloak
        displayName: Keycloak Client Scope
        kind: KeycloakClientScope
        name: keycloakclientscopes.keycloak.hostzero.com
        version: v1beta1
      - description: KeycloakComponent manages components like LDAP federation and key providers
        displayName: Keycloak Component
        kind: KeycloakComponent
        name: keycloakcomponents.keycloak.hostzero.com
        version: v1beta1
      - description: KeycloakGroup manages groups in Keycloak
        displayName: Keycloak Group
        kind: KeycloakGroup
        name: keycloakgroups.keycloak.hostzero.com
        version: v1beta1
      - description: KeycloakIdentityProvider manages external identity providers
        displayName: Keycloak Identity Provider
        kind: KeycloakIdentityProvider
        name: keycloakidentityproviders.keycloak.hostzero.com
        version: v1beta1
      - description: KeycloakInstance makes a Keycloak server known to the operator
        displayName: Keycloak Instance
        kind: KeycloakInstance
        name: keycloakinstances.keycloak.hostzero.com
        version: v1beta1
      - description: KeycloakOrganization manages organizations in Keycloak 26+
        displayName: Keycloak Organization
        kind: KeycloakOrganization
        name: keycloakorganizations.keycloak.hostzero.com
        version: v1beta1
      - description: KeycloakProtocolMapper manages token claim mappers
        displayName: Keycloak Protocol Mapper
        kind: KeycloakProtocolMapper
        name: keycloakprotocolmappers.keycloak.hostzero.com
        version: v1beta1
      - description: KeycloakRealm manages a Keycloak realm
        displayName: Keycloak Realm
        kind: KeycloakRealm
        name: keycloakrealms.keycloak.hostzero.com
        version: v1beta1
      - description: KeycloakRole manages realm and client roles
        displayName: Keycloak Role
        kind: KeycloakRole
        name: keycloakroles.keycloak.hostzero.com
        version: v1beta1
      - description: KeycloakRoleMapping manages role-to-user/group assignments
        displayName: Keycloak Role Mapping
        kind: KeycloakRoleMapping
        name: keycloakrolemappings.keycloak.hostzero.com
        version: v1beta1
      - description: KeycloakUser manages users in Keycloak
        displayName: Keycloak User
        kind: KeycloakUser
        name: keycloakusers.keycloak.hostzero.com
        version: v1beta1
      - description: KeycloakUserCredential manages user passwords
        displayName: Keycloak User Credential
        kind: KeycloakUserCredential
        name: keycloakusercredentials.keycloak.hostzero.com
        version: v1beta1
  description: |
    # Keycloak Operator
    <sub>Sponsored by [Hostzero](https://hostzero.com)</sub>

    A Kubernetes operator for managing Keycloak resources declaratively. 
    This operator enables you to manage Keycloak instances and their resources (realms, clients, users, roles, etc.) as Kubernetes Custom Resources, providing GitOps-friendly infrastructure-as-code for your identity and access management.

    ## Features

    * **Declarative Management**: Manage all Keycloak resources via Kubernetes CRDs
    * **Full Keycloak API Support**: Access complete Keycloak functionality via `definition` fields
    * **Automatic Secret Management**: Client secrets are automatically synchronized to Kubernetes Secrets
    * **Hierarchical Resources**: Natural resource hierarchy (Instance → Realm → Clients/Users)
    * **High Availability**: Built-in leader election for multi-replica deployments
    * **Prometheus Metrics**: Comprehensive observability with built-in metrics
    * **Multi-Architecture**: Supports both amd64 and arm64 platforms

    ## Supported Keycloak Versions

    * **Keycloak 20.x - 26.x**: Fully supported
    * **Keycloak 19.x and older**: Not supported
    * **Minimum version**: 20.0.0

    The operator validates the Keycloak version on connection and will fail to become ready if an unsupported version is detected.

    ## Custom Resources

    The operator provides the following Custom Resource Definitions:

    ### Connection Resources
    * **KeycloakInstance / ClusterKeycloakInstance**: Define connections to Keycloak servers
    * **KeycloakRealm / ClusterKeycloakRealm**: Manage realm configurations

    ### Authentication & Authorization
    * **KeycloakClient**: Configure OAuth2/OIDC clients
    * **KeycloakClientScope**: Define client scopes
    * **KeycloakProtocolMapper**: Configure token claim mappers
    * **KeycloakRole**: Manage realm and client roles
    * **KeycloakRoleMapping**: Assign roles to users and groups

    ### User Management
    * **KeycloakUser**: Manage user accounts
    * **KeycloakUserCredential**: Handle user passwords
    * **KeycloakGroup**: Organize users into groups

    ### Federation & Integration
    * **KeycloakIdentityProvider**: Configure external identity providers (SAML, OIDC, etc.)
    * **KeycloakComponent**: Manage LDAP federation, key providers, and other components
    * **KeycloakOrganization**: Manage organizations (Keycloak 26+)

    ## Getting Started

    ### Prerequisites

    Before installing the operator, ensure you have:
    * A running Kubernetes cluster (1.25+)
    * A Keycloak instance (version 20.0.0 or later)
    * Admin credentials for your Keycloak instance

    ### Quick Start

    1. **Create a Secret with Keycloak admin credentials:**

    ```yaml
    apiVersion: v1
    kind: Secret
    metadata:
      name: keycloak-admin
    type: Opaque
    stringData:
      username: admin
      password: your-admin-password
    ```

    2. **Create a KeycloakInstance to connect to your Keycloak server:**

    ```yaml
    apiVersion: keycloak.hostzero.com/v1beta1
    kind: KeycloakInstance
    metadata:
      name: keycloak-instance
    spec:
      baseUrl: http://keycloak:8080
      credentials:
        secretName: keycloak-admin
        usernameKey: username
        passwordKey: password
    ```

    3. **Create a Realm:**

    ```yaml
    apiVersion: keycloak.hostzero.com/v1beta1
    kind: KeycloakRealm
    metadata:
      name: my-realm
    spec:
      instanceRef: keycloak-instance
      definition:
        realm: my-realm
        displayName: My Application Realm
        enabled: true
        loginTheme: keycloak
    ```

    4. **Create a Client:**

    ```yaml
    apiVersion: keycloak.hostzero.com/v1beta1
    kind: KeycloakClient
    metadata:
      name: my-app
    spec:
      realmRef: my-realm
      definition:
        clientId: my-app
        name: My Application
        publicClient: false
        standardFlowEnabled: true
        redirectUris:
          - "https://myapp.example.com/*"
      clientSecret:
        secretName: my-app-secret
    ```

    The operator will automatically create the client in Keycloak and store the client secret in the specified Kubernetes Secret.

    ## Advanced Features

    ### Full Keycloak API Access

    All resources support a `definition` field that maps directly to the Keycloak Admin REST API. This provides access to all Keycloak features:

    ```yaml
    apiVersion: keycloak.hostzero.com/v1beta1
    kind: KeycloakRealm
    metadata:
      name: advanced-realm
    spec:
      instanceRef: keycloak-instance
      definition:
        realm: advanced
        enabled: true
        # Any Keycloak realm property is supported
        passwordPolicy: "length(12) and upperCase(1) and lowerCase(1) and digits(1)"
        bruteForceProtected: true
        permanentLockout: false
        maxFailureWaitSeconds: 900
        minimumQuickLoginWaitSeconds: 60
        waitIncrementSeconds: 60
        quickLoginCheckMilliSeconds: 1000
        maxDeltaTimeSeconds: 43200
        failureFactor: 5
        smtpServer:
          host: smtp.example.com
          port: "587"
          from: noreply@example.com
          auth: "true"
          user: smtp-user
    ```

    ### LDAP Federation

    ```yaml
    apiVersion: keycloak.hostzero.com/v1beta1
    kind: KeycloakComponent
    metadata:
      name: ldap-provider
    spec:
      realmRef: my-realm
      definition:
        name: ldap
        providerId: ldap
        providerType: org.keycloak.storage.UserStorageProvider
        config:
          enabled: ["true"]
          priority: ["1"]
          vendor: ["ad"]
          connectionUrl: ["ldap://ldap.example.com:389"]
          bindDn: ["cn=admin,dc=example,dc=com"]
          bindCredential: ["password"]
          usersDn: ["ou=users,dc=example,dc=com"]
    ```

    ### Identity Provider Integration

    ```yaml
    apiVersion: keycloak.hostzero.com/v1beta1
    kind: KeycloakIdentityProvider
    metadata:
      name: google-idp
    spec:
      realmRef: my-realm
      definition:
        alias: google
        providerId: google
        enabled: true
        config:
          clientId: "your-google-client-id"
          clientSecret: "your-google-client-secret"
    ```

    ## Monitoring

    The operator exposes Prometheus metrics at `:8080/metrics`:

    * **Reconciliation metrics**: Total reconciliations, duration, errors by controller
    * **Resource metrics**: Managed and ready resources by type
    * **Keycloak connection**: Connection status, API request counts and latency

    ### Key Metrics

    * `keycloak_operator_keycloak_connection_status`: Connection health (0=down, 1=up)
    * `keycloak_operator_reconcile_total`: Total reconciliation attempts
    * `keycloak_operator_reconcile_errors_total`: Failed reconciliations
    * `keycloak_operator_reconcile_duration_seconds`: Reconciliation latency
    * `keycloak_operator_resources_managed`: Total resources under management
    * `keycloak_operator_resources_ready`: Resources in ready state

    ## Documentation

    For comprehensive documentation, visit: https://keycloak-operator.hostzero.com

    Topics covered include:
    * Installation and configuration
    * Complete API reference for all CRDs
    * Advanced use cases and patterns
    * Monitoring and alerting
    * Troubleshooting guide
    * Migration from other Keycloak operators

    ## Support

    ### Community Support
    * GitHub Issues: https://github.com/Hostzero-GmbH/keycloak-operator/issues

    ### Enterprise Support
    This operator is developed and maintained by **Hostzero GmbH**, a provider of sovereign IT infrastructure solutions. For organizations with critical infrastructure needs (KRITIS), we offer:
    * Enterprise support with SLAs
    * Security hardening and compliance consulting
    * On-premises deployment assistance
    * 24/7 incident response
    * Training and workshops

    Contact: https://hostzero.com/contact-us

    ## License

    MIT License - Copyright (c) 2025-2026 Hostzero GmbH
  displayName: Keycloak Operator
  icon:
    - base64data: PHN2ZyB3aWR0aD0iMTY4IiBoZWlnaHQ9IjE1MSIgdmlld0JveD0iMCAwIDE2OCAxNTEiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0yMS45MDIxIDM3LjMwMTdMNDMuNTA1NyAwLjAxMzI3NjNMMTMwLjUwNiAwLjAwMTkzNzg3TDE1MS45OTIgMzcuNjYwN0wxNTIuMDE5IDExMi45OTNMMTMwLjUwOSAxNTAuNjNMNDMuNTM1OSAxNTAuNjZMMjEuNjgyOSAxMTIuOTk3TDIxLjkwMjEgMzcuMzAxN1oiIGZpbGw9IiM0RDRENEQiLz4KPHBhdGggZD0iTTIxLjY4NjcgMTEyLjk4Nkg2MC44OTUxTDM5LjM1OTYgNzUuMDM2MUw1Ni44NzM3IDM3LjMwOTNMMjEuOTA1OSAzNy4zMDE3TDAgNzUuMzQyMiIgZmlsbD0iI0VERURFRCIvPgo8cGF0aCBkPSJNNzIuNzg1MyAxMTIuOTg2SDEwMS40NDVMMTI2Ljc4NyA3Ni4wNDlMMTAxLjg4NyAzNy42NjQ1SDY4LjE3NDRMNDcuODY3MiA3NC43NTY0TDcyLjc4NTMgMTEyLjk4NloiIGZpbGw9IiNFMEUwRTAiLz4KPHBhdGggZD0iTTAgNzUuMzM4NEwyMS42ODY3IDExMi45OTdINjAuODk4OUwzOS41OTc3IDc1LjQ2NjlMMCA3NS4zMzg0WiIgZmlsbD0iI0FDQUNBQyIvPgo8cGF0aCBkPSJNNDguMjc5MiA3NS4zNDZMNzIuNzg5MSAxMTIuOTk3SDEwMS40NDVMMTI2LjM5IDc1LjM2MTFMNDguMjc5MiA3NS4zNDZaIiBmaWxsPSIjOUU5RTlFIi8+CjxwYXRoIGQ9Ik01Ny45ODQ5IDc1LjM2NDlMNTAuNTg4NCA3Ny41MTkyTDQzLjQ5MDUgNzUuMzYxMUw3Mi40Njc5IDI1LjEzMTdMNzkuNzE2OSAzNy42NzIxIiBmaWxsPSIjMDBCOEUzIi8+CjxwYXRoIGQ9Ik03OS42ODY3IDExMi45ODZMNzIuNDc1NSAxMjUuNTc5TDUzLjIyNjUgMTA0Ljg0MUw0My40NzU1IDc1LjM3MjVWNzUuMzU3M0g1Ny45ODExIiBmaWxsPSIjMzNDNkU5Ii8+CjxwYXRoIGQ9Ik00My40OTQzIDc1LjM2MTFINDMuNDc5MlY3NS4zNzI1TDM2LjIzMzkgODcuOTI3OUwyOC45NTg0IDc1LjQyOTJMMzYuMzM2IDYyLjYzMThMNTcuOTg0OSAyNS4xMzkzSDcyLjQ3NTQiIGZpbGw9IiMwMDhBQUEiLz4KPHBhdGggZD0iTTEyMy4yMjYgMTEyLjk4NkgxNjcuMTE0TDE2Ny4wODcgMzcuNjYwN0gxMjMuMjI2VjExMi45ODZaIiBmaWxsPSIjRDRENEQ0Ii8+CjxwYXRoIGQ9Ik0xMjMuMjI2IDc1LjQ2MzJWMTEyLjk5M0gxNjcuMDM0Vjc1LjQ2MzJIMTIzLjIyNloiIGZpbGw9IiM5MTkxOTEiLz4KPHBhdGggZD0iTTcyLjQ4MyAxMjUuNTk0SDU3Ljk4MTFMMzYuMjMzOSA4Ny45MjQxTDQzLjQ3OTIgNzUuMzc2Mkw3Mi40ODMgMTI1LjU5NFoiIGZpbGw9IiMwMEI4RTMiLz4KPHBhdGggZD0iTTEzMC40NjQgNzUuMzYxMUwxMDEuNDc5IDEyNS41ODNDOTguODE0NyAxMjEuNjY3IDk0LjI0OTEgMTEyLjk5NyA5NC4yNDkxIDExMi45OTdMMTE1Ljk5MiA3NS4zNTM2TDEzMC40NjQgNzUuMzYxMVoiIGZpbGw9IiMwMDhBQUEiLz4KPHBhdGggZD0iTTExNS45NTUgMTI1LjU4M0wxMDEuNDc5IDEyNS41NzlMMTMwLjQ2OCA3NS4zNTczTDEzNy43MDkgNjIuODE3TDE0NC45NzQgNzUuNDQwNU0xMzAuNDY0IDc1LjM2MTFIMTE1Ljk5Nkw5NC4yNDUzIDM3LjY2ODNMMTAxLjQ0NSAyNS4xNDMxTDExOS4wNSA0Ny41MjUyTDEzMC40NjQgNzUuMzYxMVoiIGZpbGw9IiMwMEI4RTMiLz4KPHBhdGggZD0iTTEzNy43MDkgNjIuODA5NVY2Mi44MjA4TDEzMC40NjQgNzUuMzYxMUwxMDEuNDQ5IDI1LjE0NjlMMTE1Ljk2NiAyNS4xNTQ0TDEzNy43MDkgNjIuODA5NVoiIGZpbGw9IiMzM0M2RTkiLz4KPC9zdmc+Cg==
      mediatype: image/svg+xml
  install:
    spec:
      clusterPermissions:
        - rules:
            - apiGroups:
                - ""
              resources:
                - secrets
              verbs:
                - create
                - delete
                - get
                - list
                - patch
                - update
                - watch
            - apiGroups:
                - keycloak.hostzero.com
              resources:
                - clusterkeycloakinstances
                - clusterkeycloakrealms
                - keycloakclients
                - keycloakclientscopes
                - keycloakcomponents
                - keycloakgroups
                - keycloakidentityproviders
                - keycloakinstances
                - keycloakorganizations
                - keycloakprotocolmappers
                - keycloakrealms
                - keycloakrolemappings
                - keycloakroles
                - keycloakusercredentials
                - keycloakusers
              verbs:
                - create
                - delete
                - get
                - list
                - patch
                - update
                - watch
            - apiGroups:
                - keycloak.hostzero.com
              resources:
                - clusterkeycloakinstances/finalizers
                - clusterkeycloakrealms/finalizers
                - keycloakclients/finalizers
                - keycloakclientscopes/finalizers
                - keycloakcomponents/finalizers
                - keycloakgroups/finalizers
                - keycloakidentityproviders/finalizers
                - keycloakinstances/finalizers
                - keycloakorganizations/finalizers
                - keycloakprotocolmappers/finalizers
                - keycloakrealms/finalizers
                - keycloakrolemappings/finalizers
                - keycloakroles/finalizers
                - keycloakusercredentials/finalizers
                - keycloakusers/finalizers
              verbs:
                - update
            - apiGroups:
                - keycloak.hostzero.com
              resources:
                - clusterkeycloakinstances/status
                - clusterkeycloakrealms/status
                - keycloakclients/status
                - keycloakclientscopes/status
                - keycloakcomponents/status
                - keycloakgroups/status
                - keycloakidentityproviders/status
                - keycloakinstances/status
                - keycloakorganizations/status
                - keycloakprotocolmappers/status
                - keycloakrealms/status
                - keycloakrolemappings/status
                - keycloakroles/status
                - keycloakusercredentials/status
                - keycloakusers/status
              verbs:
                - get
                - patch
                - update
          serviceAccountName: hostzero-keycloak-operator-controller-manager
      deployments:
        - label:
            app.kubernetes.io/component: manager
            app.kubernetes.io/name: keycloak-operator
            control-plane: controller-manager
          name: hostzero-keycloak-operator-controller-manager
          spec:
            replicas: 1
            selector:
              matchLabels:
                app.kubernetes.io/component: manager
                app.kubernetes.io/name: keycloak-operator
                control-plane: controller-manager
            strategy: {}
            template:
              metadata:
                labels:
                  app.kubernetes.io/component: manager
                  app.kubernetes.io/name: keycloak-operator
                  control-plane: controller-manager
              spec:
                containers:
                  - args:
                      - --leader-elect
                    image: ghcr.io/hostzero-gmbh/keycloak-operator:v0.1.1
                    livenessProbe:
                      httpGet:
                        path: /healthz
                        port: 8081
                      initialDelaySeconds: 15
                      periodSeconds: 20
                    name: manager
                    ports:
                      - containerPort: 8080
                        name: metrics
                        protocol: TCP
                      - containerPort: 8081
                        name: health
                        protocol: TCP
                    readinessProbe:
                      httpGet:
                        path: /readyz
                        port: 8081
                      initialDelaySeconds: 5
                      periodSeconds: 10
                    resources:
                      limits:
                        cpu: 500m
                        memory: 256Mi
                      requests:
                        cpu: 100m
                        memory: 128Mi
                    securityContext:
                      allowPrivilegeEscalation: false
                      capabilities:
                        drop:
                          - ALL
                securityContext:
                  runAsNonRoot: true
                  seccompProfile:
                    type: RuntimeDefault
                serviceAccountName: hostzero-keycloak-operator-controller-manager
                terminationGracePeriodSeconds: 10
      permissions:
        - rules:
            - apiGroups:
                - ""
              resources:
                - configmaps
              verbs:
                - get
                - list
                - watch
                - create
                - update
                - patch
                - delete
            - apiGroups:
                - coordination.k8s.io
              resources:
                - leases
              verbs:
                - get
                - list
                - watch
                - create
                - update
                - patch
                - delete
            - apiGroups:
                - ""
              resources:
                - events
              verbs:
                - create
                - patch
          serviceAccountName: hostzero-keycloak-operator-controller-manager
    strategy: deployment
  installModes:
    - supported: true
      type: OwnNamespace
    - supported: true
      type: SingleNamespace
    - supported: true
      type: MultiNamespace
    - supported: true
      type: AllNamespaces
  keywords:
    - keycloak
    - identity
    - authentication
    - authorization
    - oauth2
    - oidc
    - saml
    - sso
    - iam
  links:
    - name: Documentation
      url: https://keycloak-operator.hostzero.com
    - name: GitHub Repository
      url: https://github.com/Hostzero-GmbH/keycloak-operator
    - name: Hostzero GmbH
      url: https://hostzero.com
  maintainers:
    - email: opensource@hostzero.com
      name: Hostzero GmbH
  maturity: beta
  minKubeVersion: 1.25.0
  provider:
    name: Hostzero GmbH
    url: https://hostzero.com
  version: 0.1.1
