apiVersion: operators.coreos.com/v1alpha1
kind: ClusterServiceVersion
metadata:
  name: opensearch-operator.v2.8.0
  namespace: placeholder
  annotations:
    alm-examples: |-
      [
        {
          "apiVersion": "opensearch.opster.io/v1",
          "kind": "OpenSearchCluster",
          "metadata": {
            "name": "my-cluster"
          },
          "spec": {
            "general": {
              "httpPort": 9200,
              "serviceName": "my-cluster",
              "version": "2.14.0"
            },
            "security": {
              "tls": {
                "http": {"generate": true},
                "transport": {"generate": true, "perNode": true}
              }
            },
            "dashboards": {
              "enable": true,
              "replicas": 1,
              "version": "2.14.0"
            },
            "nodePools": [
              {
                "component": "masters",
                "replicas": 3,
                "roles": ["data", "cluster_manager"],
                "resources": {
                  "requests": {"memory": "2Gi", "cpu": "500m"},
                  "limits": {"memory": "2Gi", "cpu": "500m"}
                },
                "persistence": {"emptyDir": {}}
              }
            ]
          }
        },
        {
          "apiVersion": "opensearch.opster.io/v1",
          "kind": "OpensearchRole",
          "metadata": {"name": "my-role"},
          "spec": {
            "opensearchCluster": {"name": "my-cluster"},
            "clusterPermissions": ["cluster_monitor"],
            "indexPermissions": [{"indexPatterns": ["*"], "allowedActions": ["read"]}]
          }
        },
        {
          "apiVersion": "opensearch.opster.io/v1",
          "kind": "OpensearchUser",
          "metadata": {"name": "my-user"},
          "spec": {
            "opensearchCluster": {"name": "my-cluster"},
            "passwordFrom": {"name": "my-user-password", "key": "password"}
          }
        },
        {
          "apiVersion": "opensearch.opster.io/v1",
          "kind": "OpensearchUserRoleBinding",
          "metadata": {"name": "my-binding"},
          "spec": {
            "opensearchCluster": {"name": "my-cluster"},
            "users": ["my-user"],
            "roles": ["my-role"]
          }
        }
      ]
    categories: 'Database, Big Data'
    certified: 'false'
    createdAt: '2024-12-30'
    description: Kubernetes operator for automating deployment and management of OpenSearch clusters.
    containerImage: 'opensearchproject/opensearch-operator:2.8.0'
    support: OpenSearch Project
    capabilities: Deep Insights
    repository: 'https://github.com/opensearch-project/opensearch-k8s-operator'
spec:
  displayName: OpenSearch Operator
  description: |
    The OpenSearch Kubernetes Operator automates deployment, provisioning, management, and orchestration of OpenSearch clusters and dashboards.

    ## Features
    - Deploy and manage OpenSearch clusters
    - Manage OpenSearch Dashboards
    - Automated TLS certificate management
    - Rolling upgrades and restarts
    - Cluster scaling
    - Security configuration (roles, users, role bindings)
    - Index State Management policies
    - Index and component templates
    - Snapshot policies

    ## Documentation
    [OpenSearch Operator Docs](https://github.com/opensearch-project/opensearch-k8s-operator/tree/main/docs)
  maturity: stable
  version: 2.8.0
  minKubeVersion: 1.23.0
  keywords:
    - OpenSearch
    - Search
    - Analytics
    - Database
    - Logging
  maintainers:
    - name: OpenSearch Project
      email: opensearch-infra@amazon.com
  provider:
    name: OpenSearch Project
    url: https://opensearch.org
  links:
    - name: OpenSearch
      url: 'https://opensearch.org'
    - name: GitHub
      url: 'https://github.com/opensearch-project/opensearch-k8s-operator'
  icon:
    - base64data: PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij48ZyBmaWxsPSJub25lIj48cGF0aCBmaWxsPSIjMDA1RWI4IiBkPSJNMzIgNjRjMTcuNjczIDAgMzItMTQuMzI3IDMyLTMyQzY0IDE0LjMyNyA0OS42NzMgMCAzMiAwIDE0LjMyNyAwIDAgMTQuMzI3IDAgMzJjMCAxNy42NzMgMTQuMzI3IDMyIDMyIDMyeiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik0zMiAxNmMtOC44MzcgMC0xNiA3LjE2My0xNiAxNnM3LjE2MyAxNiAxNiAxNiAxNi03LjE2MyAxNi0xNi03LjE2My0xNi0xNi0xNnptMCAyOGMtNi42MjcgMC0xMi01LjM3My0xMi0xMnM1LjM3My0xMiAxMi0xMiAxMiA1LjM3MyAxMiAxMi01LjM3MyAxMi0xMiAxMnoiLz48Y2lyY2xlIGN4PSIzMiIgY3k9IjMyIiByPSI2IiBmaWxsPSIjRkZGIi8+PC9nPjwvc3ZnPg==
      mediatype: image/svg+xml
  customresourcedefinitions:
    owned:
      - name: opensearchclusters.opensearch.opster.io
        displayName: OpenSearchCluster
        kind: OpenSearchCluster
        version: v1
        description: Represents an OpenSearch cluster
      - name: opensearchroles.opensearch.opster.io
        displayName: OpensearchRole
        kind: OpensearchRole
        version: v1
        description: OpenSearch security role
      - name: opensearchusers.opensearch.opster.io
        displayName: OpensearchUser
        kind: OpensearchUser
        version: v1
        description: OpenSearch user
      - name: opensearchuserrolebindings.opensearch.opster.io
        displayName: OpensearchUserRoleBinding
        kind: OpensearchUserRoleBinding
        version: v1
        description: Binds users to roles
      - name: opensearchtenants.opensearch.opster.io
        displayName: OpensearchTenant
        kind: OpensearchTenant
        version: v1
        description: OpenSearch tenant
      - name: opensearchactiongroups.opensearch.opster.io
        displayName: OpensearchActionGroup
        kind: OpensearchActionGroup
        version: v1
        description: OpenSearch action group
      - name: opensearchismpolicies.opensearch.opster.io
        displayName: OpenSearchISMPolicy
        kind: OpenSearchISMPolicy
        version: v1
        description: Index State Management policy
      - name: opensearchindextemplates.opensearch.opster.io
        displayName: OpensearchIndexTemplate
        kind: OpensearchIndexTemplate
        version: v1
        description: OpenSearch index template
      - name: opensearchcomponenttemplates.opensearch.opster.io
        displayName: OpensearchComponentTemplate
        kind: OpensearchComponentTemplate
        version: v1
        description: OpenSearch component template
      - name: opensearchsnapshotpolicies.opensearch.opster.io
        displayName: OpensearchSnapshotPolicy
        kind: OpensearchSnapshotPolicy
        version: v1
        description: OpenSearch snapshot policy
  install:
    strategy: deployment
    spec:
      clusterPermissions:
        - serviceAccountName: opensearch-operator-controller-manager
          rules:
            - apiGroups: [""]
              resources: [configmaps, namespaces, persistentvolumeclaims, pods, secrets, services]
              verbs: [create, delete, get, list, patch, update, watch]
            - apiGroups: [""]
              resources: [events]
              verbs: [create, patch, update]
            - apiGroups: [apps]
              resources: [deployments, statefulsets, statefulsets/status]
              verbs: [create, delete, get, list, patch, update, watch]
            - apiGroups: [batch]
              resources: [jobs]
              verbs: [create, delete, get, list, patch, update, watch]
            - apiGroups: [monitoring.coreos.com]
              resources: [servicemonitors]
              verbs: [create, delete, get, list, patch, update, watch]
            - apiGroups: [opensearch.opster.io]
              resources: [opensearchactiongroups, opensearchclusters, opensearchcomponenttemplates, opensearchindextemplates, opensearchismpolicies, opensearchroles, opensearchsnapshotpolicies, opensearchtenants, opensearchuserrolebindings, opensearchusers]
              verbs: [create, delete, get, list, patch, update, watch]
            - apiGroups: [opensearch.opster.io]
              resources: [opensearchactiongroups/finalizers, opensearchclusters/finalizers, opensearchcomponenttemplates/finalizers, opensearchindextemplates/finalizers, opensearchismpolicies/finalizers, opensearchroles/finalizers, opensearchsnapshotpolicies/finalizers, opensearchtenants/finalizers, opensearchuserrolebindings/finalizers, opensearchusers/finalizers]
              verbs: [update]
            - apiGroups: [opensearch.opster.io]
              resources: [opensearchactiongroups/status, opensearchclusters/status, opensearchcomponenttemplates/status, opensearchindextemplates/status, opensearchismpolicies/status, opensearchroles/status, opensearchsnapshotpolicies/status, opensearchtenants/status, opensearchuserrolebindings/status, opensearchusers/status]
              verbs: [get, patch, update]
            - apiGroups: [policy]
              resources: [poddisruptionbudgets]
              verbs: [create, delete, get, list, patch, update, watch]
      deployments:
        - name: opensearch-operator-controller-manager
          spec:
            replicas: 1
            selector:
              matchLabels:
                control-plane: opensearch-operator-controller-manager
            template:
              metadata:
                labels:
                  control-plane: opensearch-operator-controller-manager
              spec:
                securityContext:
                  runAsNonRoot: true
                serviceAccountName: opensearch-operator-controller-manager
                terminationGracePeriodSeconds: 10
                containers:
                  - name: manager
                    image: 'opensearchproject/opensearch-operator:2.8.0'
                    imagePullPolicy: Always
                    command: [/manager]
                    args: [--loglevel=info]
                    securityContext:
                      allowPrivilegeEscalation: false
                    livenessProbe:
                      httpGet:
                        path: /healthz
                        port: 8081
                      initialDelaySeconds: 15
                      periodSeconds: 20
                    readinessProbe:
                      httpGet:
                        path: /readyz
                        port: 8081
                      initialDelaySeconds: 5
                      periodSeconds: 10
                    resources:
                      limits:
                        cpu: 500m
                        memory: 500Mi
                      requests:
                        cpu: 200m
                        memory: 350Mi
  installModes:
    - type: OwnNamespace
      supported: true
    - type: SingleNamespace
      supported: true
    - type: MultiNamespace
      supported: true
    - type: AllNamespaces
      supported: true
