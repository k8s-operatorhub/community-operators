apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: supergraphschemas.apollographql.com
spec:
  group: apollographql.com
  names:
    categories: []
    kind: SupergraphSchema
    plural: supergraphschemas
    shortNames: []
    singular: supergraphschema
  scope: Namespaced
  versions:
  - additionalPrinterColumns: []
    name: v1alpha2
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for SupergraphSchemaSpec via `CustomResource`
        properties:
          spec:
            description: SupergraphSchema Specification
            properties:
              compositionEnabled:
                description: |-
                  Enable requesting and tracking compositions

                  When set to false, the Operator will continue to track `Subgraph` resource changes, but will not send composition requests nor track the result of pending compositions.
                nullable: true
                type: boolean
              deletionPolicy:
                default: KeepVariant
                description: Policy when deleting the SupergraphSchema
                enum:
                - DeleteVariant
                - KeepVariant
                type: string
              graphRef:
                description: Graph variant name (e.g. `graph@variant`) used to request compositions.
                type: string
              partial:
                description: |-
                  Indicates that this represents a partial supergraph schema

                  Set this to true when other SupergraphSchemas or other tools may make changes to subgraphs that are not managed by this SupergraphSchema.
                nullable: true
                type: boolean
              selectors:
                default: []
                description: Selectors for subgraphs
                items:
                  description: A label selector is a label query over a set of resources. The result of matchLabels and matchExpressions are ANDed. An empty label selector matches all objects. A null label selector matches no objects.
                  properties:
                    matchExpressions:
                      description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
                      items:
                        description: A label selector requirement is a selector that contains values, a key, and an operator that relates the key and values.
                        properties:
                          key:
                            description: key is the label key that the selector applies to.
                            type: string
                          operator:
                            description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
                            type: string
                          values:
                            description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
                            items:
                              type: string
                            type: array
                        required:
                        - key
                        - operator
                        type: object
                      type: array
                    matchLabels:
                      additionalProperties:
                        type: string
                      description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
                      type: object
                  type: object
                type: array
              subgraphPrefix:
                description: |-
                  Optional prefix for all subgraphs managed by this SupergraphSchema

                  If this has a value, all subgraph names will start with this prefix and a dash. This is useful to avoid collisions for partial SupergraphSchemas.
                nullable: true
                type: string
            required:
            - graphRef
            type: object
          status:
            description: Status of a `SupergraphSchema` resource
            nullable: true
            properties:
              composition:
                description: State of the latest known composition associated with this `SupergraphSchema`
                nullable: true
                properties:
                  graphRef:
                    description: Graph variant reference
                    type: string
                  launchId:
                    description: Studio launch ID
                    type: string
                required:
                - graphRef
                - launchId
                type: object
              conditions:
                description: |-
                  Set of conditions for this `SupergraphSchema`

                  Following Kubernetes API conventions, conditions are represented as a list of named subobjects instead of a map.
                items:
                  description: Status condition
                  properties:
                    composition:
                      description: Composition status
                      nullable: true
                      properties:
                        graphRef:
                          description: Graph variant reference
                          type: string
                        launchId:
                          description: Studio launch ID
                          type: string
                      required:
                      - graphRef
                      - launchId
                      type: object
                    lastTransitionTime:
                      description: lastTransitionTime is the last time the condition transitioned from one status to another. This should be when the underlying condition changed. If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: message is a human readable message indicating details about the transition. This may be an empty string.
                      type: string
                    observedGeneration:
                      description: observedGeneration represents the .metadata.generation that the condition was set based upon. For instance, if .metadata.generation is currently 12, but the .status.conditions\[x\].observedGeneration is 9, the condition is out of date with respect to the current state of the instance.
                      format: int64
                      nullable: true
                      type: integer
                    reason:
                      description: reason contains a programmatic identifier indicating the reason for the conditionâ€™s last transition. Producers of specific condition types may define expected values and meanings for this field, and whether the values are considered a guaranteed API. The value should be a CamelCase string. This field may not be empty.
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - 'True'
                      - 'False'
                      - Unknown
                      type: string
                    subgraphs:
                      description: Subgraph statuses
                      items:
                        description: Subgraph status
                        properties:
                          name:
                            description: Subgraph name
                            type: string
                          namespace:
                            description: Subergraph namespace
                            type: string
                          schema:
                            description: Known subgraph schema
                            nullable: true
                            oneOf:
                            - required:
                              - sdlHash
                            - required:
                              - oci
                            - required:
                              - ociImage
                            properties:
                              endpoint:
                                description: Known endpoint
                                format: uri
                                nullable: true
                                type: string
                              oci:
                                description: OCI artifact source status
                                properties:
                                  sdlHash:
                                    description: Digest of the artifact
                                    type: string
                                  updatedAt:
                                    description: last time this was updated
                                    format: date-time
                                    type: string
                                required:
                                - sdlHash
                                - updatedAt
                                type: object
                              ociImage:
                                description: OCI image source status
                                properties:
                                  sdlHash:
                                    description: Digest of the artifact
                                    type: string
                                  updatedAt:
                                    description: last time this was updated
                                    format: date-time
                                    type: string
                                required:
                                - sdlHash
                                - updatedAt
                                type: object
                              sdlHash:
                                description: In-line schema source status
                                type: string
                            type: object
                        required:
                        - name
                        - namespace
                        type: object
                      type: array
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - subgraphs
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              subgraphs:
                description: State of subgraphs associated with this `SupergraphSchema`
                items:
                  description: Subgraph status
                  properties:
                    name:
                      description: Subgraph name
                      type: string
                    namespace:
                      description: Subergraph namespace
                      type: string
                    schema:
                      description: Known subgraph schema
                      nullable: true
                      oneOf:
                      - required:
                        - sdlHash
                      - required:
                        - oci
                      - required:
                        - ociImage
                      properties:
                        endpoint:
                          description: Known endpoint
                          format: uri
                          nullable: true
                          type: string
                        oci:
                          description: OCI artifact source status
                          properties:
                            sdlHash:
                              description: Digest of the artifact
                              type: string
                            updatedAt:
                              description: last time this was updated
                              format: date-time
                              type: string
                          required:
                          - sdlHash
                          - updatedAt
                          type: object
                        ociImage:
                          description: OCI image source status
                          properties:
                            sdlHash:
                              description: Digest of the artifact
                              type: string
                            updatedAt:
                              description: last time this was updated
                              format: date-time
                              type: string
                          required:
                          - sdlHash
                          - updatedAt
                          type: object
                        sdlHash:
                          description: In-line schema source status
                          type: string
                      type: object
                  required:
                  - name
                  - namespace
                  type: object
                type: array
            required:
            - conditions
            - subgraphs
            type: object
        required:
        - spec
        title: SupergraphSchema
        type: object
    served: true
    storage: true
    subresources:
      status: {}
